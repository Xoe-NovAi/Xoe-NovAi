# ============================================================================
# Xoe-NovAi Phase 1 v0.1.2 - Environment Configuration
# ============================================================================
# Purpose: Runtime environment variables for all services
# Guide Reference: Section 2.4 (Complete .env Specification)
# Last Updated: 2025-10-16
# Variables: 197 total (REQUIRED fields must be customized)
# Changes (v0.1.2): Full expansion, aligned with Grok guide
# ============================================================================

# ============================================================================
# STACK IDENTITY
# ============================================================================
STACK_NAME=xnai-stack
STACK_VERSION=v0.1.2
COMPOSE_PROJECT_NAME=xnai
APP_UID=1001                             # REQUIRED: Non-root user ID
APP_GID=1001                             # REQUIRED: Non-root group ID

# ============================================================================
# REDIS CONFIGURATION (7.4.1 - rev_1.4)
# ============================================================================
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=CHANGE_ME_16PLUS_CHARS    # REQUIRED: 16+ character secure password
REDIS_TIMEOUT=60
REDIS_MAX_CONNECTIONS=50
REDIS_APPENDONLY=yes
REDIS_APPENDFSYNC=everysec
REDIS_MAXMEMORY=512mb
REDIS_MAXMEMORY_POLICY=allkeys-lru
REDIS_TCP_BACKLOG=2048
REDIS_PROTECTED_MODE=no
REDIS_STREAM_MAX_LEN=1000                # NEW rev_1.4: Phase 2 streams
REDIS_CACHE_TTL=3600
REDIS_CACHE_PREFIX=xnai_cache
REDIS_CACHE_MAX_KEYS=10000

# ============================================================================
# THREADING OPTIMIZATION (AMD Ryzen 7 5700U - 8C/16T)
# ============================================================================
LLAMA_CPP_N_THREADS=6                    # REQUIRED: 75% utilization optimal
OMP_NUM_THREADS=1                        # REQUIRED: Separate auxiliary libs
OPENBLAS_NUM_THREADS=1
MKL_NUM_THREADS=1
OPENBLAS_CORETYPE=ZEN                    # REQUIRED: AMD Zen2 architecture
MKL_DEBUG_CPU_TYPE=5                     # REQUIRED: Zen2 optimization
VECLIB_MAXIMUM_THREADS=1

# ============================================================================
# MEMORY MANAGEMENT (Target: <6GB)
# ============================================================================
LLAMA_CPP_F16_KV=true                    # CRITICAL: Do not change
LLAMA_CPP_USE_MLOCK=true
LLAMA_CPP_USE_MMAP=true
LLAMA_CPP_N_BATCH=512
LLAMA_CPP_N_CTX=2048
MEMORY_LIMIT_GB=6.0
MEMORY_WARNING_THRESHOLD_GB=5.5
MEMORY_CRITICAL_THRESHOLD_GB=5.8

# ============================================================================
# LLM CONFIGURATION
# ============================================================================
LLM_MODEL_PATH=/models/gemma-3-4b-it-UD-Q5_K_XL.gguf
LLM_SIZE_GB=2.8
LLM_QUANTIZATION=Q5_K_XL
LLM_CONTEXT_WINDOW=2048
LLM_TEMPERATURE=0.7
LLM_TOP_P=0.9
LLM_TOP_K=40
LLM_REPEAT_PENALTY=1.1
LLM_MAX_TOKENS=512
LLM_STOP_SEQUENCES='["\n\n", "###"]'     # Fixed comma parse
LLM_ECHO=false
LLM_LOGPROBS=false
LLM_SEED=-1

# ============================================================================
# EMBEDDINGS CONFIGURATION
# ============================================================================
EMBEDDING_MODEL_PATH=/embeddings/all-MiniLM-L12-v2.Q8_0.gguf
EMBEDDING_SIZE_MB=45
EMBEDDING_DIMENSIONS=384
EMBEDDING_MODEL_NAME=sentence-transformers/all-MiniLM-L12-v2
EMBEDDING_DEVICE=cpu
EMBEDDING_NORMALIZE=true
EMBEDDING_BATCH_SIZE=32

# ============================================================================
# SERVER CONFIGURATION
# ============================================================================
API_HOST=0.0.0.0
API_PORT=8000
UI_HOST=0.0.0.0
UI_PORT=8001
METRICS_PORT=8002
CORS_ORIGINS="http://localhost:8001,http://127.0.0.1:8001"
LOG_LEVEL=info

# ============================================================================
# TELEMETRY DISABLES (8 total - Zero-Telemetry Enforcement)
# ============================================================================
CHAINLIT_NO_TELEMETRY=true
CRAWL4AI_NO_TELEMETRY=true
LLAMA_CPP_NO_TELEMETRY=true
LANGCHAIN_NO_TELEMETRY=true
FAISS_NO_TELEMETRY=true
PROMETHEUS_NO_TELEMETRY=true
UVICORN_NO_TELEMETRY=true
FASTAPI_NO_TELEMETRY=true

# ============================================================================
# CRAWL MODULE CONFIGURATION (v0.1.7)
# ============================================================================
CRAWL4AI_NO_TELEMETRY=true
CRAWL_ALLOWLIST_URLS="*.gutenberg.org,*.arxiv.org,*.nih.gov,*.youtube.com"
CRAWL_RATE_LIMIT_PER_MIN=30
CRAWL_CACHE_TTL=86400
CRAWL_SANITIZE_SCRIPTS=true
CRAWL_MAX_ITEMS=50
CRAWL_DRY_RUN=false
CRAWL_EMBED_ON_SUCCESS=true
CRAWL_SOURCES="gutenberg,arxiv,pubmed,youtube"
CRAWL_GUTENBERG_ENABLED=true
CRAWL_ARXIV_ENABLED=true
CRAWL_PUBMED_ENABLED=true
CRAWL_YOUTUBE_ENABLED=true

# ============================================================================
# RAG CONFIGURATION
# ============================================================================
RAG_ENABLED=true
RAG_TOP_K=5
RAG_SIMILARITY_THRESHOLD=0.7
RAG_RERANK_RESULTS=true
RAG_PER_DOC_CHARS=500
RAG_TOTAL_CHARS=2048
RAG_CHUNK_SIZE=1000
RAG_CHUNK_OVERLAP=200
RAG_SEARCH_TIMEOUT_S=10

# ============================================================================
# HEALTH CHECK CONFIGURATION
# ============================================================================
HEALTH_CHECK_INTERVAL=30s
HEALTH_CHECK_TIMEOUT=15s
HEALTH_CHECK_RETRIES=5
HEALTH_CHECK_START_PERIOD=90s
HEALTH_CHECK_COMMAND="python3 /app/XNAi_rag_app/healthcheck.py"
HEALTH_TARGETS="llm,embeddings,memory,redis,vectorstore,ryzen,crawler"
HEALTH_CHECK_MEMORY_MAX_GB=6.0
HEALTH_CHECK_LLM_TIMEOUT=10
HEALTH_CHECK_REDIS_TIMEOUT=5
HEALTH_CHECK_CRAWLER_TIMEOUT=10

# ============================================================================
# SECURITY CONFIGURATION
# ============================================================================
SECURITY_NON_ROOT_UID=1001
SECURITY_NON_ROOT_GID=1001
SECURITY_DROP_CAPABILITIES=ALL
SECURITY_ADD_CAPABILITIES="SETGID,SETUID,CHOWN"
SECURITY_NO_NEW_PRIVILEGES=true

# ============================================================================
# AUTOMATION CONFIGURATION
# ============================================================================
ERROR_RECOVERY_ENABLED=true
BACKUP_ENABLED=true
BACKUP_INTERVAL_HOURS=24
AUTO_INGEST_ON_STARTUP=true

# ============================================================================
# PHASE 2 PREPARATION (Disabled)
# ============================================================================
PHASE2_MULTI_AGENT_ENABLED=false
PHASE2_QDRANT_ENABLED=false
PHASE2_MAX_CONCURRENT_AGENTS=4
PHASE2_AGENT_TIMEOUT_S=300
PHASE2_REDIS_SESSIONS=false

# ============================================================================
# VECTORSTORE CONFIGURATION
# ============================================================================
VECTORSTORE_TYPE=faiss
VECTORSTORE_MAX_DOCS=1000000
VECTORSTORE_SAVE_TIMEOUT_S=30
VECTORSTORE_INGEST_BATCH_SIZE=100
VECTORSTORE_VERIFY_ON_LOAD=true

# ============================================================================
# DEBUG CONFIGURATION
# ============================================================================
DEBUG_MODE=false
DEBUG_VERBOSE_ERRORS=false
DEBUG_PROFILING_ENABLED=false
DEBUG_TRACE_REQUESTS=false

# ============================================================================
# DOCKER CONFIGURATION
# ============================================================================
COMPOSE_PROJECT_NAME=xnai
BUILDKIT_INLINE_CACHE=1
DOCKER_BUILDKIT=1

# ============================================================================
# SESSION CONFIGURATION
# ============================================================================
SESSION_TIMEOUT_S=3600
SESSION_MAX_CONCURRENT=10
SESSION_PERSIST=true

# ============================================================================
# VALIDATION METADATA
# ============================================================================
# Expected variable count: 197 (rev_1.4)
# Critical Ryzen flags: LLAMA_CPP_N_THREADS=6, F16_KV=true, CORETYPE=ZEN
# Zero-telemetry count: 8 (added CRAWL4AI_NO_TELEMETRY in rev_1.4)
# Guide version: v0.1.2 rev_1.4
# Last validated: 2025-10-16